<!DOCTYPE html>
<html lang="cs" class="scroll-smooth">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin Portál | America Pod Věží</title>
    <!-- Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500&family=Oswald:wght@400;500;700&display=swap" rel="stylesheet">
    
    <!-- Tailwind CSS (build) -->
    <link rel="stylesheet" href="output.css">
    <link rel="stylesheet" href="fa/css/fontawesome.min.css">
    <link rel="stylesheet" href="fa/css/solid.min.css">
</head>
<body class="bg-black text-white min-h-screen flex flex-col font-sans">
    
    <!-- Header -->
    <header class="bg-[#050505] border-b border-white/10 sticky top-0 z-50">
        <div class="max-w-5xl mx-auto px-6 py-4 flex justify-between items-center">
            <div class="flex items-center gap-4">
                <span class="text-white font-heading font-bold tracking-[0.2em] text-lg border border-brand-gold/50 px-3 py-1 bg-brand-gold/10 shadow-[0_0_10px_rgba(212,163,115,0.2)]">
                    ADMIN
                </span>
                <span class="hidden md:inline text-brand-gold font-heading tracking-widest text-sm uppercase opacity-80">
                    America Pod Věží
                </span>
            </div>
            <div class="flex items-center gap-4">
                <a href="/" target="_blank" class="text-xs text-gray-400 hover:text-white uppercase tracking-widest transition flex items-center gap-2">
                    <i class="fas fa-external-link-alt"></i> Web
                </a>
                <button id="save-btn-top" class="bg-brand-gold text-black font-heading font-bold uppercase tracking-widest text-xs px-4 py-2 rounded-sm hover:bg-white transition">
                    Uložit
                </button>
            </div>
        </div>
    </header>

    <!-- Main Content -->
    <main class="flex-grow w-full max-w-5xl mx-auto px-6 py-10">
        
        <div id="alert" class="hidden mb-8 p-4 rounded-sm text-sm font-bold border flex items-center gap-3">
            <i class="fas" id="alert-icon"></i>
            <span id="alert-text"></span>
        </div>

        <form id="admin-form" class="space-y-10">
            
            <!-- Sekce: Režim Otevírací doby -->
            <section class="bg-white/5 border border-white/10 rounded-sm p-6 md:p-8 shadow-xl">
                <div class="flex items-center gap-3 mb-6 border-b border-white/10 pb-4">
                    <div class="w-8 h-8 rounded-full border border-brand-gold/30 bg-brand-gold/10 flex items-center justify-center text-brand-gold">
                        <i class="fas fa-clock"></i>
                    </div>
                    <h2 class="text-2xl font-heading font-bold tracking-widest uppercase text-white">Režim otevírací doby</h2>
                </div>

                <p class="text-gray-400 text-sm mb-6 font-light">
                    Vyberte šablonu otevírací doby. Podle vybraného režimu se na webu vygenerují příslušné řádky.
                </p>

                <div class="grid grid-cols-1 md:grid-cols-3 gap-4 mb-8">
                    <!-- Mode 1 -->
                    <label class="relative cursor-pointer group">
                        <input type="radio" name="hoursMode" value="mode1" class="peer sr-only">
                        <div class="h-full bg-[#111] border border-white/10 rounded-sm p-4 peer-checked:border-brand-gold peer-checked:bg-brand-gold/5 transition">
                            <div class="flex items-center justify-between mb-2">
                                <span class="font-heading font-bold uppercase tracking-wider text-sm text-white">Jednotný týden</span>
                                <i class="fas fa-check-circle text-brand-gold opacity-0 peer-checked:opacity-100 transition"></i>
                            </div>
                            <div class="text-xs text-gray-500 flex flex-col gap-1">
                                <span>Po-Pá: Stejný čas</span>
                                <span>So: Zvlášť</span>
                                <span>Ne: Zvlášť</span>
                            </div>
                        </div>
                    </label>

                    <!-- Mode 2 -->
                    <label class="relative cursor-pointer group">
                        <input type="radio" name="hoursMode" value="mode2" class="peer sr-only">
                        <div class="h-full bg-[#111] border border-white/10 rounded-sm p-4 peer-checked:border-brand-gold peer-checked:bg-brand-gold/5 transition">
                            <div class="flex items-center justify-between mb-2">
                                <span class="font-heading font-bold uppercase tracking-wider text-sm text-white">Standard (Nyní)</span>
                                <i class="fas fa-check-circle text-brand-gold opacity-0 peer-checked:opacity-100 transition"></i>
                            </div>
                            <div class="text-xs text-gray-500 flex flex-col gap-1">
                                <span>Po: Zvlášť</span>
                                <span>Út-Pá: Stejný čas</span>
                                <span>So, Ne: Zvlášť</span>
                            </div>
                        </div>
                    </label>

                    <!-- Mode 3 -->
                    <label class="relative cursor-pointer group">
                        <input type="radio" name="hoursMode" value="mode3" class="peer sr-only">
                        <div class="h-full bg-[#111] border border-white/10 rounded-sm p-4 peer-checked:border-brand-gold peer-checked:bg-brand-gold/5 transition">
                            <div class="flex items-center justify-between mb-2">
                                <span class="font-heading font-bold uppercase tracking-wider text-sm text-white">Celý týden</span>
                                <i class="fas fa-check-circle text-brand-gold opacity-0 peer-checked:opacity-100 transition"></i>
                            </div>
                            <div class="text-xs text-gray-500 flex flex-col gap-1">
                                <span>Po-Ne: Stejný čas</span>
                            </div>
                        </div>
                    </label>
                </div>

                <!-- Editor aktuálně vybraného režimu -->
                <div class="bg-black border border-white/5 p-4 rounded-sm">
                    <h3 class="font-heading uppercase tracking-widest text-xs text-brand-gold mb-4">Editace vybraného režimu:</h3>
                    <div id="hours-editor" class="flex flex-col gap-3">
                        <!-- Dynamicky generováno pomocí JS -->
                    </div>
                </div>
            </section>

            <!-- Sekce: Kontakty -->
            <section class="bg-white/5 border border-white/10 rounded-sm p-6 md:p-8 shadow-xl">
                <div class="flex items-center gap-3 mb-6 border-b border-white/10 pb-4">
                    <div class="w-8 h-8 rounded-full border border-brand-gold/30 bg-brand-gold/10 flex items-center justify-center text-brand-gold">
                        <i class="fas fa-address-book"></i>
                    </div>
                    <h2 class="text-2xl font-heading font-bold tracking-widest uppercase text-white">Kontaktní údaje</h2>
                </div>

                <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                    <div>
                        <label class="block text-xs font-heading tracking-widest uppercase text-gray-400 mb-2">Hlavní telefon</label>
                        <div class="relative">
                            <div class="absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none">
                                <i class="fas fa-phone text-gray-600 text-sm"></i>
                            </div>
                            <input type="text" id="phoneMain" class="w-full bg-[#111] border border-white/10 text-white rounded-sm py-2 pl-10 pr-3 focus:outline-none focus:border-brand-gold focus:ring-1 focus:ring-brand-gold/50 transition">
                        </div>
                    </div>
                    <div>
                        <label class="block text-xs font-heading tracking-widest uppercase text-gray-400 mb-2">Alternativní telefon</label>
                        <div class="relative">
                            <div class="absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none">
                                <i class="fas fa-mobile-alt text-gray-600 text-sm pl-0.5"></i>
                            </div>
                            <input type="text" id="phoneAlt" class="w-full bg-[#111] border border-white/10 text-white rounded-sm py-2 pl-10 pr-3 focus:outline-none focus:border-brand-gold focus:ring-1 focus:ring-brand-gold/50 transition">
                        </div>
                    </div>
                    <div class="md:col-span-2">
                        <label class="block text-xs font-heading tracking-widest uppercase text-gray-400 mb-2">E-mailová adresa</label>
                        <div class="relative">
                            <div class="absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none">
                                <i class="fas fa-envelope text-gray-600 text-sm"></i>
                            </div>
                            <input type="email" id="email" class="w-full bg-[#111] border border-white/10 text-white rounded-sm py-2 pl-10 pr-3 focus:outline-none focus:border-brand-gold focus:ring-1 focus:ring-brand-gold/50 transition">
                        </div>
                    </div>
                </div>
            </section>

            <!-- Ulozit Dole -->
            <div class="flex justify-end">
                <button type="submit" class="bg-brand-gold text-black font-heading font-bold uppercase tracking-widest py-3 px-8 rounded-sm hover:bg-white transition shadow-[0_0_15px_rgba(212,163,115,0.4)] hover:shadow-[0_0_20px_rgba(255,255,255,0.5)]">
                    Uložit všechny změny
                </button>
            </div>
        </form>
    </main>

    <!-- Patička -->
    <footer class="bg-[#050505] text-center py-6 border-t border-white/10 mt-auto">
        <p class="text-[10px] uppercase tracking-widest text-gray-600">
            America Pod Věží &copy; <span id="year"></span> | Admin Modul
        </p>
    </footer>

    <script>
        document.getElementById('year').textContent = new Date().getFullYear();

        document.addEventListener('DOMContentLoaded', async () => {
            const form = document.getElementById('admin-form');
            const alertBox = document.getElementById('alert');
            const alertIcon = document.getElementById('alert-icon');
            const alertText = document.getElementById('alert-text');
            const hoursEditor = document.getElementById('hours-editor');
            const topSaveBtn = document.getElementById('save-btn-top');
            
            let appData = {
                openHoursMode: 'mode2',
                openHours: {},
                contacts: {}
            };

            const showAlert = (msg, isSuccess) => {
                alertText.textContent = msg;
                alertIcon.className = isSuccess ? 'fas fa-check-circle' : 'fas fa-exclamation-triangle';
                alertBox.className = `mb-8 p-4 rounded-sm text-sm font-bold border flex items-center gap-3 ${isSuccess ? 'bg-green-900/20 border-green-500/50 text-green-400' : 'bg-red-900/20 border-red-500/50 text-red-400'}`;
                alertBox.classList.remove('hidden');
                window.scrollTo({ top: 0, behavior: 'smooth' });
                setTimeout(() => alertBox.classList.add('hidden'), 4000);
            };

            // Vykreslí inputy podle zvoleného režimu
            const renderHoursEditor = (mode) => {
                hoursEditor.innerHTML = '';
                if (!appData.openHours[mode]) return;

                appData.openHours[mode].forEach((item, index) => {
                    const row = document.createElement('div');
                    row.className = "flex flex-col sm:flex-row sm:items-center gap-2 p-2 hover:bg-white/5 rounded transition border border-transparent hover:border-white/5";
                    
                    row.innerHTML = `
                        <div class="sm:w-1/3">
                            <span class="text-sm text-gray-300 font-bold">${item.label}</span>
                        </div>
                        <div class="sm:w-2/3">
                            <input type="text" value="${item.time}" data-mode="${mode}" data-index="${index}" class="hours-input w-full bg-[#111] border border-white/20 text-white text-sm rounded-sm py-2 px-3 focus:outline-none focus:border-brand-gold focus:ring-1 focus:ring-brand-gold/50 transition">
                        </div>
                    `;
                    hoursEditor.appendChild(row);
                });

                // Přidání listenerů pro průběžný update dat v paměti
                document.querySelectorAll('.hours-input').forEach(input => {
                    input.addEventListener('input', (e) => {
                        const iMode = e.target.getAttribute('data-mode');
                        const idx = e.target.getAttribute('data-index');
                        appData.openHours[iMode][idx].time = e.target.value;
                    });
                });
            };

            // Posluchače na radio buttony změny režimu
            document.querySelectorAll('input[name="hoursMode"]').forEach(radio => {
                radio.addEventListener('change', (e) => {
                    appData.openHoursMode = e.target.value;
                    renderHoursEditor(e.target.value);
                });
            });

            // Načtení dat při startu
            try {
                const response = await fetch('/api/data');
                if (response.ok) {
                    appData = await response.json();
                    
                    // Set radio mode
                    const activeRadio = document.querySelector(`input[name="hoursMode"][value="${appData.openHoursMode}"]`);
                    if (activeRadio) activeRadio.checked = true;

                    // Vykreslení editoru hodin
                    renderHoursEditor(appData.openHoursMode);

                    // Set contacts
                    document.getElementById('phoneMain').value = appData.contacts.phoneMain || '';
                    document.getElementById('phoneAlt').value = appData.contacts.phoneAlt || '';
                    document.getElementById('email').value = appData.contacts.email || '';
                }
            } catch (err) {
                showAlert('Chyba při načítání dat ze serveru.', false);
            }

            // Uložení funkce
            const saveData = async () => {
                appData.contacts.phoneMain = document.getElementById('phoneMain').value;
                appData.contacts.phoneAlt = document.getElementById('phoneAlt').value;
                appData.contacts.email = document.getElementById('email').value;

                try {
                    const res = await fetch('/api/data', {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify(appData)
                    });
                    
                    if (res.ok) {
                        showAlert('Změny byly úspěšně uloženy a promítnuty na web.', true);
                    } else {
                        showAlert('Nepodařilo se uložit data na server.', false);
                    }
                } catch (err) {
                    showAlert('Kritická chyba při ukládání. Zkontrolujte připojení.', false);
                }
            };

            // Event Listeners pro uložení
            form.addEventListener('submit', (e) => {
                e.preventDefault();
                saveData();
            });

            topSaveBtn.addEventListener('click', (e) => {
                e.preventDefault();
                saveData();
            });
        });
    </script>
</body>
</html>